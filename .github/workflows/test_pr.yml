name: Test Pull Request
on:
  pull_request:
    branches: [ staging ]
    
jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        DISTRIBUTION: ["DISTRIBUTION_0", "DISTRIBUTION_1"]

    env: 
      GH_TOKEN: ${{secrets.GH_TOKEN}}
      DISTRIBUTION: ${{secrets[matrix.DISTRIBUTION]}}
      
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        
      - name: Yarn cache
        uses: c-hive/gha-yarn-cache@v1

      - name: Authenticate git clone
        run: echo -e "machine github.com\n  login ${GH_TOKEN}" > ~/.netrc
        
      - name: Install JS dependencies
        run: yarn --frozen-lockfile
        
      - name: Test
        run: yarn test
